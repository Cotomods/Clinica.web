@model Clinica.Web.Models.GenerarTurnosViewModel

@{
    ViewData["Title"] = "Generar turnos";
}

<h1>Generar turnos para @Model.MedicoNombre</h1>

<form asp-action="GenerarTurnos" method="post">
    <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

    <input type="hidden" asp-for="MedicoId" />

    <div class="row g-3">
        <div class="col-md-3">
            <label asp-for="FechaDesde" class="form-label"></label>
            <input asp-for="FechaDesde" class="form-control" type="date" />
            <span asp-validation-for="FechaDesde" class="text-danger"></span>
        </div>

        <div class="col-md-3">
            <label asp-for="FechaHasta" class="form-label"></label>
            <input asp-for="FechaHasta" class="form-control" type="date" />
            <span asp-validation-for="FechaHasta" class="text-danger"></span>
        </div>

        <div class="col-md-3">
            <label asp-for="DuracionMinutos" class="form-label"></label>
            <input asp-for="DuracionMinutos" class="form-control" />
            <span asp-validation-for="DuracionMinutos" class="text-danger"></span>
        </div>

        <div class="col-12">
            <label class="form-label">Horarios por día</label>
            <div class="table-responsive">
                <table class="table table-sm align-middle">
                    <thead>
                    <tr>
                        <th style="width: 1%;"></th>
                        <th>Día</th>
                        <th style="width: 180px;">Inicio</th>
                        <th style="width: 180px;">Fin</th>
                    </tr>
                    </thead>
                    <tbody>
                    @{
                        string NombreDia(DayOfWeek d) => d switch
                        {
                            DayOfWeek.Monday => "Lunes",
                            DayOfWeek.Tuesday => "Martes",
                            DayOfWeek.Wednesday => "Miércoles",
                            DayOfWeek.Thursday => "Jueves",
                            DayOfWeek.Friday => "Viernes",
                            DayOfWeek.Saturday => "Sábado",
                            DayOfWeek.Sunday => "Domingo",
                            _ => d.ToString()
                        };
                    }

                    @for (var i = 0; i < Model.HorariosPorDia.Count; i++)
                    {
                        <tr>
                            <td>
                                <input type="hidden" asp-for="HorariosPorDia[i].Dia" />
                                <input class="form-check-input" asp-for="HorariosPorDia[i].Atiende" />
                            </td>
                            <td>
                                <span>@NombreDia(Model.HorariosPorDia[i].Dia)</span>
                            </td>
                            <td>
                                <input asp-for="HorariosPorDia[i].HoraInicio" class="form-control" type="time" />
                                <span asp-validation-for="HorariosPorDia[i].HoraInicio" class="text-danger"></span>
                            </td>
                            <td>
                                <input asp-for="HorariosPorDia[i].HoraFin" class="form-control" type="time" />
                                <span asp-validation-for="HorariosPorDia[i].HoraFin" class="text-danger"></span>
                            </td>
                        </tr>
                    }
                    </tbody>
                </table>
            </div>
            <span asp-validation-for="HorariosPorDia" class="text-danger"></span>
        </div>
    </div>

    <div class="mt-3">
        <button type="submit" class="btn btn-primary">Generar</button>
        <a asp-action="Index" class="btn btn-secondary">Volver</a>
    </div>
</form>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        // Habilitar/deshabilitar horarios según el check de cada día
        document.addEventListener('DOMContentLoaded', function () {
            const rows = document.querySelectorAll('table tbody tr');

            function updateRow(row) {
                const checkbox = row.querySelector('input[type="checkbox"]');
                const inputs = row.querySelectorAll('input[type="time"]');

                const enabled = checkbox && checkbox.checked;
                inputs.forEach(i => {
                    // Solo deshabilitamos; no borramos para que si el usuario vuelve a marcar el día
                    // conserve los valores que había elegido.
                    i.disabled = !enabled;
                });
            }

            rows.forEach(row => {
                const checkbox = row.querySelector('input[type="checkbox"]');
                if (checkbox) {
                    checkbox.addEventListener('change', function () {
                        updateRow(row);
                    });
                }
                updateRow(row);
            });
        });
    </script>
}
